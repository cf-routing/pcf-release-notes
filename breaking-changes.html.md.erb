---
title: Pivotal Platform Breaking Changes
owner: Release Engineering
---

<% current_page.data.title = vars.platform_name + " " + vars.v_major_version + " Breaking Changes" %>

This topic describes the breaking changes you need to be aware of when upgrading to <%= vars.platform_name %> <%= vars.v_major_version %>. For more information about important preparation steps you must follow before beginning an upgrade, see [Upgrading <%= vars.platform_name %>](https://docs.pivotal.io/platform/<%= product_info['local_product_version'].to_s.sub('.','-') %>/customizing/upgrading-pcf.html).


## <a id='platform'></a> <%= vars.platform_name %>

See the following <%= vars.platform_name %> breaking changes:

### <a id='scs-2x-not-supported'></a> Pivotal Spring Cloud Services v2.0.x Not Compatible with <%= vars.platform_name %> <%= vars.v_major_version %>.

Pivotal Spring Cloud Services (SCS) v2.0.x is not compatible with <%= vars.platform_name %> <%= vars.v_major_version %>. You cannot upgrade to <%= vars.ops_manager %> <%= vars.v_major_version %>. or <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>. without either removing SCS v2.0.x or upgrading from SCS v2.0.x to SCS v2.1.x first.

If you need to use the `p-circuit-breaker-dashboard` service in SCS v2.0.x, you must upgrade SCS v2.0.x to SCS v2.1.x before you upgrade to <%= vars.platform_name %> <%= vars.v_major_version %>..

If you are running SCS v3.0.x or SCS v3.1.x alongside SCS v2.0.x and do not require `p-circuit-breaker-dashboard` functionality, you can remove SCS v2.0.x entirely after migrating completely to SCS v3.1.x. Follow the procedure in [How to Upgrade to SCS v3.1](https://docs.pivotal.io/spring-cloud-services/3-1/product-upgrades.html#upgrade-to-3-1).

After you successfully remove SCS v2.0.x or upgrade to SCS v2.1.x, you can proceed with the <%= vars.platform_name %> <%= vars.v_major_version %>. upgrade procedure. For more information, see [Upgrading <%= vars.platform_name %>](https://docs.pivotal.io/platform/2-7/customizing/upgrading-pcf.html).


## <a id='opsman'></a> <%= vars.ops_manager_full %>

See the following <%= vars.ops_manager %> breaking changes:

### <a id='renamed-stemcell-endpoint'></a> Stemcell Assignments Endpoint Removed

The `stemcells_assignments` endpoint in the <%= vars.ops_manager %> API has been removed.

Instead, operators must use the `stemcell_associations` endpoint, which returns information about all stemcells associated with a product.

For more information, see [Stemcell Associations for Products](https://docs.pivotal.io/platform/2-7/opsman-api/#stemcell-associations-for-products) in the <%= vars.ops_manager %> API documentation.

### <a id='bosh-cli-v1'></a> BOSH CLI v1 Not Supported

<%= vars.ops_manager %> <%= vars.v_major_version %> does not support BOSH CLI v1.

If you use BOSH CLI v1 commands manually from your workstation or in automation scripts, you must update your usage to BOSH CLI v2. For more information, see [Installing the CLI](https://bosh.io/docs/cli-v2-install/) and [Commands](https://bosh.io/docs/cli-v2/) in the BOSH documentation.


## <a id='pas'></a> <%= vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>)

See the following <%= vars.app_runtime_abbr %> breaking changes:

### <a id='credhub-interpolate-with-https'></a> Incorrect HTTP(S) Proxy Configuration Breaks CredHub Interpolation for Apps in <%= vars.app_runtime_abbr %> v2.7.18 and Later

In <%= vars.app_runtime_abbr %> v2.7.18 and later, apps that have an incorrect HTTP(S) Proxy configuration fail to stage or restart due to a CredHub interpolation error. 

Before you upgrade to <%= vars.app_runtime_abbr %> v2.7.18 or later, you must fix the HTTP(S) Proxy configuration of any impacted applications:

1. Determine whether your apps are impacted by following the resolution procedure in [Knowledgebase Article 9305](https://community.pivotal.io/s/article/Credhub-Reference-Can-t-Be-Interpolated-Due-To-Improper-HTTP-S-Proxy-Configuration).
1. Update all impacted apps to use the recommended proxy settings that are documented in [Configuring Proxy Settings for All Apps](https://docs.pivotal.io/application-service/2-7/operating/config-proxy.html).
1. Restart modified apps.

### <a id='no-external-blobstores'></a> You Cannot Install <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>.0 or <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>.1 with External Blobstores

You cannot install or deploy <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>.0 or <%= vars.v_major_version %>.1 with external blobstores. For more information, see [You Cannot Install <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>.0 or <%= vars.v_major_version %>.1 with External Blobstores](runtime-rn.html#no-external-blobstores) in _<%= vars.app_runtime_full %> <%= vars.v_major_version %> Release Notes_.

### <a id='consul-server'></a> Consul Clients Not Supported in <%= vars.app_runtime_abbr %>

The Consul server instance is removed from <%= vars.app_runtime_abbr %>. Tile authors must remove any Consul clients from their products to avoid failed deployments.

To remove Consul clients from your products, make the following changes to any `job_type` that is colocated with `consul_agent`:

```
- name: consul_agent
    release: consul
    ...
    manifest: |
      ...
      consul:
        client:
          enabled: "(( $ops_manager.dns_enabled ? false : true ))"
```

For more information about removing Consul clients from your products, see [Tile Authors Must Remove consul_agent](https://docs.pivotal.io/tiledev/2-4/release-notes.html#breaking-consul) in _<%= vars.platform_name %> v2.4 Partner Release Notes_.

### <a id="syslog-agents"></a> Do Not Edit Syslog Agent Configuration When Upgrading from <%= vars.app_runtime_abbr %> v2.7.6 or Earlier

If you are upgrading from <%= vars.app_runtime_abbr %> v2.7.6 or earlier, do not change your Syslog Agent configuration when you stage <%= vars.app_runtime_abbr %> v2.7.7 or later for the first time. For example, if Syslog Agents are enabled on your current version of <%= vars.app_runtime_abbr %>, ensure that Syslog Agents are enabled when you stage <%= vars.app_runtime_abbr %> v2.7.7 or later for the first time.

If you change your Syslog Agent configuration after staging and before the first deploy of <%= vars.app_runtime_abbr %> v2.7.7 or later, there is a significant period of log loss or log duplication while BOSH enables or disables Syslog Agents. For more information about this log loss or duplication, see [Duplicate or Missing Logs](runtime-rn.html#duplicate-logs) in _<%= vars.app_runtime_full %> v2.7 Release Notes_.

You can edit the Syslog Agent configuration in <%= vars.app_runtime_abbr %> v2.7.7
or later after the first deploy. To edit your Syslog Agent configuration, see
[Configure System Logging](https://docs.pivotal.io/application-service/2-7/operating/configure-pas.html#sys-logging)
in _Configuring <%= vars.app_runtime_abbr %>_.

### <a id='syslog-agent-metadata'></a> Metadata Tags for Metrics and App Logs

Agent-based syslog egress is enabled and non-configurable in <%= vars.app_runtime_abbr %> v2.7.6 and earlier, but can be disabled in <%= vars.app_runtime_abbr %> v2.7.7 and later. Syslog Agents forward logs to Loggregator and syslog drains that you configure.

If you enable Agent-based syslog egress in <%= vars.app_runtime_abbr %> v2.7.7 or later, your app logs and metrics include metadata tags.
Tags appear after the header of each syslog message and before the syslog message text.
You must update any external monitoring configuration you use to account for the new format and tags.

The new metadata tags appear in app logs in the following format:

<pre class="terminal">
956 <14>1 2020-03-31T12:11:02.529497+00:00 Tax_us-uat.AI.tax-plis-blue
ec3cd4e4-baf9-456d-965a-96bcb2c61a47 [APP/PROC/WEB/0]
[tags@47450 deployment="cf-78e7a9442158adb53366" index="c57b95c6-d79f-4cfb-b7f3-08a770946b7a"
instance_id="0" ip="10.214.110.84" job="diego_cell" origin="rep"
process_id="ec3cd4e4-baf9-456d-965a-96bcb2c61a47"
process_instance_id="1cf3854e-29d8-4825-7685-11ec" process_type="web"
product="Pivotal Application Service" source_id="ec3cd4e4-baf9-456d-965a-96bcb2c61a47"
source_type="APP/PROC/WEB" system_domain="example.my-domain.io"]
2020-03-31 07:11:02.529 INFO [tax-plis,B2347215-T21118008-COWF/35558169/38311791]
--- [http-nio-8080-exec-5] c.c.b.t.p.s.p.b.BatchPostProcessor :
Report file created in 47 ms
</pre>

### <a id='props-changed'></a> Changed Properties and Jobs

The following <%= vars.app_runtime_abbr %> tile properties and <%= vars.app_runtime_abbr %> jobs have changed in <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>.

Before upgrading to <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>, you must update any automation scripts to remove or change references to these properties and jobs.

* UAA properties `uaadb.tls_enabled` and `uaadb.skip_ssl_validation`
  - The UAA properties `uaadb.tls_enabled` and `uaadb.skip_ssl_validation` are removed and replaced by `uaadb.tls`
  - For more information, see [UAA Property uaadb.tls Consolidates TLS Configuration Options](runtime-rn.html#uaadb) in _<%= vars.app_runtime_full %> <%= vars.v_major_version %> Release Notes_.

* Syslog jobs `syslog_adapter` and `syslog_scheduler`, and property `syslog_metrics_to_syslog_enabled`
  - The job instance groups `syslog_adapter` and `syslog_scheduler`, and the property `syslog_metrics_to_syslog_enabled` are removed.
  - Agent-based syslog egress renders these items unnecessary. For more information, see [Agent-Based Syslog Egress Is Enabled by Default](runtime-rn.html#agent-based-syslog-egress) in _<%= vars.app_runtime_full %> <%= vars.v_major_version %> Release Notes_.

* Container networking property `cf_networking_internal_domains`
  - The `cf_networking_internal_domains` is now an array.

* Runtime CredHub property `credhub_key_encryption_passwords`
  - The `credhub_key_encryption_passwords` property is replaced by `credhub_hsm_provider_encryption_keys` for HSM-resident CredHub and `credhub_internal_provider_keys` for internal CredHub.


## <a id='pasw'></a> <%= vars.windows_runtime_full %>

See the following <%= vars.windows_runtime_full %> (<%= vars.windows_runtime_abbr %>) breaking changes:

### <a id='credhub-interpolate-with-https-win'></a> Incorrect HTTP(S) Proxy Configuration Breaks CredHub Interpolation for Apps in <%= vars.windows_runtime_abbr %> v2.7.15 and Later

In <%= vars.windows_runtime_abbr %> v2.7.15 and later, apps that have an incorrect HTTP(S) Proxy configuration fail to stage or restart due to a CredHub interpolation error. 

Before you upgrade to <%= vars.windows_runtime_abbr %> v2.7.15 or later, you must fix the HTTP(S) Proxy configuration of any impacted applications:

1. Determine whether your apps are impacted by following the resolution procedure in [Knowledgebase Article 9305](https://community.pivotal.io/s/article/Credhub-Reference-Can-t-Be-Interpolated-Due-To-Improper-HTTP-S-Proxy-Configuration).
1. Update all impacted apps to use the recommended proxy settings that are documented in [Configuring Proxy Settings for All Apps](https://docs.pivotal.io/application-service/2-7/operating/config-proxy.html).
1. Restart modified apps.

### <a id='windows2016'></a> Windows2016 Stack is Deprecated

In <%= vars.windows_runtime_abbr %> <%= vars.v_major_version %>, the `windows2016` stack is deprecated. Before you upgrade to <%= vars.windows_runtime_full %> <%= vars.v_major_version %>, you can migrate any apps that run on the `windows2016` stack to the `windows` stack.

You can migrate your apps from `windows2016` to `windows` using Stack Auditor, a Cloud Foundry CLI plugin. For more information, see [Using the Stack Auditor Plugin](https://docs.pivotal.io/platform/adminguide/stack-auditor.html).

### <a id='rdp'></a> RDP is Not Supported

The **Enable Remote Desktop Protocol** field is removed from the <%= vars.windows_runtime_abbr %> tile. <%= vars.windows_runtime_abbr %> VMs do not support connection through RDP.

Remove references to `.properties.rdp_enabled` in any automated scripts to avoid errors during upgrade.

To access Windows VMs, use `bosh ssh`. To enable `bosh ssh` for Windows VM, select **Enable BOSH-native SSH support on all VMs** in the <%= vars.windows_runtime_abbr %> tile.

For more information, see [Configure VMs](https://docs.pivotal.io/platform/application-service-windows/2-7/installing.html#config-vms) in _Installing and Configuring <%= vars.windows_runtime_abbr %>_.

### <a id='props-changed-pasw'></a> Changed Syslog Properties and Jobs

The following <%= vars.windows_runtime_abbr %> tile properties and jobs have been removed in <%= vars.windows_runtime_abbr %> <%= vars.v_major_version %>:

* Syslog job `syslog_adapter`
* Syslog job `syslog_scheduler`
* Syslog property `syslog_metrics_to_syslog_enabled`

Before upgrading to <%= vars.windows_runtime_abbr %> <%= vars.v_major_version %>, you must update any automation scripts to remove or change references to these properties and jobs.

These changes mirror <%= vars.app_runtime_abbr %> tile changes described in [Changed Properties and Jobs](#props-changed).

For more information, see [Agent-Based Syslog Egress Is Enabled by Default](windows-rn.html#agent-based-syslog-egress) in _<%= vars.windows_runtime_full %> <%= vars.v_major_version %> Release Notes_.


## <a id='ist'></a> <%= vars.segment_runtime_full %>

See the following <%= vars.segment_runtime_full %> breaking changes:

### <a id='credhub-interpolate-with-https-iso'></a> Incorrect HTTP(S) Proxy Configuration Breaks CredHub Interpolation for Apps in <%= vars.segment_runtime_full %> v2.7.18 and Later

In <%= vars.segment_runtime_full %> v2.7.18 and later, apps that have an incorrect HTTP(S) Proxy configuration fail to stage or restart due to a CredHub interpolation error. 

Before you upgrade to <%= vars.segment_runtime_full %> v2.7.18 or later, you must fix the HTTP(S) Proxy configuration of any impacted applications:

1. Determine whether your apps are impacted by following the resolution procedure in [Knowledgebase Article 9305](https://community.pivotal.io/s/article/Credhub-Reference-Can-t-Be-Interpolated-Due-To-Improper-HTTP-S-Proxy-Configuration).
1. Update all impacted apps to use the recommended proxy settings that are documented in [Configuring Proxy Settings for All Apps](https://docs.pivotal.io/application-service/2-7/operating/config-proxy.html).
1. Restart modified apps.

### <a id='props-changed-ist'></a> Changed Syslog Properties and Jobs

The following <%= vars.segment_runtime_full %> tile properties and jobs have been removed in <%= vars.windows_runtime_full %> <%= vars.v_major_version %>:

* Syslog job `syslog_adapter`
* Syslog job `syslog_scheduler`
* Syslog property `syslog_metrics_to_syslog_enabled`

Before upgrading to <%= vars.app_runtime_abbr %> <%= vars.v_major_version %>, you must update any automation scripts to remove or change references to these properties and jobs.

These changes mirror <%= vars.app_runtime_abbr %> tile changes described in [Changed Properties and Jobs](#props-changed) above.

For more information, see [Agent-Based Syslog Egress Is Enabled by Default](segment-rn.html#agent-based-syslog-egress) in _<%= vars.segment_runtime_full %> <%= vars.v_major_version %> Release Notes_.

### <a id='ist-diego'></a> Isolation Segment Diego Cells Update Diego Securely Over Port 8447

Diego Cells deployed by the <%= vars.segment_runtime_full %> tile communicate with the Diego file server with HTTPS over port 8447.
Previously, <%= vars.segment_runtime_full %> Diego Cells communicated with HTTP over port 8080 like Diego Cells deployed by the <%= vars.app_runtime_abbr %> tile itself.

If you use isolation segments, you must ensure that port 8447 is open on the Diego Brain file server VM, which is deployed by the <%= vars.app_runtime_abbr %> tile.


## <a id='pks'></a> <%= vars.k8s_runtime_full %> (<%= vars.k8s_runtime_abbr %>)

For breaking changes in <%= vars.k8s_runtime_abbr %> v1.5, see [Breaking Changes](https://docs.pivotal.io/pks/1-5/release-notes.html#v1.5.0-breaking-changes) in the _<%= vars.k8s_runtime_full %> Release Notes_.
